Xs <- toyModel("coupled_Complex")

params <- new("CoupledMWCAParams",
    Xs=Xs,
    dimnames=list(
        X1=c("I1", "I2", "I3", "I4"),
        X2=c("I1", "I5", "I6"),
        X3=c("I2", "I7", "I8"),
        X4=c("I3", "I9", "I10"),
        X5=c("I4", "I11", "I12"),
        X6=c("I5", "I13"),
        X7=c("I6", "I14"),
        X8=c("I7", "I15"),
        X9=c("I8", "I16"),
        X10=c("I9", "I17"),
        X11=c("I10", "I18"),
        X12=c("I11", "I19"),
        X13=c("I12", "I20")),
    mask=list(
        X1=NULL,
        X2=NULL,
        X3=NULL,
        X4=NULL,
        X5=NULL,
        X6=NULL,
        X7=NULL,
        X8=NULL,
        X9=NULL,
        X10=NULL,
        X11=NULL,
        X12=NULL,
        X13=NULL),
    weights=list(
        X1=1,
        X2=1,
        X3=1,
        X4=1,
        X5=1,
        X6=1,
        X7=1,
        X8=1,
        X9=1,
        X10=1,
        X11=1,
        X12=1,
        X13=1),
    initial=list(
        X1=list(A1=NULL, A2=NULL, A3=NULL, A4=NULL),
        X2=list(A1=NULL, A5=NULL, A6=NULL),
        X3=list(A2=NULL, A7=NULL, A8=NULL),
        X4=list(A3=NULL, A9=NULL, A10=NULL),
        X5=list(A4=NULL, A11=NULL, A12=NULL),
        X6=list(A5=NULL, A13=NULL),
        X7=list(A6=NULL, A14=NULL),
        X8=list(A7=NULL, A15=NULL),
        X9=list(A8=NULL, A16=NULL),
        X10=list(A9=NULL, A17=NULL),
        X11=list(A10=NULL, A18=NULL),
        X12=list(A11=NULL, A19=NULL),
        X13=list(A12=NULL, A20=NULL)),
    algorithms=list(
        X1=list(A1="myALS_SVD", A2="myNMF", A3="myCX", A4="myALS_SVD"),
        X2=list(A1="myALS_SVD", A5="myALS_SVD", A6="myALS_SVD"),
        X3=list(A2="myNMF", A7="myALS_SVD", A8="myALS_SVD"),
        X4=list(A3="myCX", A9="myALS_SVD", A10="myALS_SVD"),
        X5=list(A4="myALS_SVD", A11="myALS_SVD", A12="myALS_SVD"),
        X6=list(A5="myALS_SVD", A13="myALS_SVD"),
        X7=list(A6="myALS_SVD", A14="myALS_SVD"),
        X8=list(A7="myALS_SVD", A15="myALS_SVD"),
        X9=list(A8="myALS_SVD", A16="myALS_SVD"),
        X10=list(A9="myALS_SVD", A17="myALS_SVD"),
        X11=list(A10="myALS_SVD", A18="myALS_SVD"),
        X12=list(A11="myALS_SVD", A19="myALS_SVD"),
        X13=list(A12="myALS_SVD", A20="myALS_SVD")),
    # algorithms=list(
    #     X1=list(A1="mySVD", A2="myALS_SVD", A3="myNMF", A4="myCX"),
    #     X2=list(A1="mySVD", A5="mySVD", A6="myALS_SVD"),
    #     X3=list(A2="myALS_SVD", A7="mySVD", A8="myALS_SVD"),
    #     X4=list(A3="myNMF", A9="mySVD", A10="myALS_SVD"),
    #     X5=list(A4="myCX", A11="mySVD", A12="myALS_SVD"),
    #     X6=list(A5="mySVD", A13="mySVD"),
    #     X7=list(A6="myALS_SVD", A14="myALS_SVD"),
    #     X8=list(A7="mySVD", A15="mySVD"),
    #     X9=list(A8="myALS_SVD", A16="myALS_SVD"),
    #     X10=list(A9="mySVD", A17="mySVD"),
    #     X11=list(A10="myALS_SVD", A18="myALS_SVD"),
    #     X12=list(A11="mySVD", A19="mySVD"),
    #     X13=list(A12="myALS_SVD", A20="myALS_SVD")),
    iteration=list(
        X1=list(A1=30, A2=30, A3=30, A4=30),
        X2=list(A1=30, A5=30, A6=30),
        X3=list(A2=30, A7=30, A8=30),
        X4=list(A3=30, A9=30, A10=30),
        X5=list(A4=30, A11=30, A12=30),
        X6=list(A5=30, A13=30),
        X7=list(A6=30, A14=30),
        X8=list(A7=30, A15=30),
        X9=list(A8=30, A16=30),
        X10=list(A9=30, A17=30),
        X11=list(A10=30, A18=30),
        X12=list(A11=30, A19=30),
        X13=list(A12=30, A20=30)),
    # iteration=list(
    #     X1=list(A1=30, A2=25, A3=20, A4=15),
    #     X2=list(A1=25, A5=1, A6=5),
    #     X3=list(A2=20, A7=1, A8=5),
    #     X4=list(A3=15, A9=1, A10=5),
    #     X5=list(A4=30, A11=1, A12=5),
    #     X6=list(A5=1, A13=1),
    #     X7=list(A6=5, A14=5),
    #     X8=list(A7=1, A15=1),
    #     X9=list(A8=5, A16=5),
    #     X10=list(A9=1, A17=1),
    #     X11=list(A10=5, A18=5),
    #     X12=list(A11=1, A19=1),
    #     X13=list(A12=5, A20=5)),
    decomp=list(
        X1=list(A1=TRUE, A2=TRUE, A3=TRUE, A4=TRUE),
        X2=list(A1=TRUE, A5=TRUE, A6=TRUE),
        X3=list(A2=TRUE, A7=TRUE, A8=TRUE),
        X4=list(A3=TRUE, A9=TRUE, A10=TRUE),
        X5=list(A4=TRUE, A11=TRUE, A12=TRUE),
        X6=list(A5=TRUE, A13=TRUE),
        X7=list(A6=TRUE, A14=TRUE),
        X8=list(A7=TRUE, A15=TRUE),
        X9=list(A8=TRUE, A16=TRUE),
        X10=list(A9=TRUE, A17=TRUE),
        X11=list(A10=TRUE, A18=TRUE),
        X12=list(A11=TRUE, A19=TRUE),
        X13=list(A12=TRUE, A20=TRUE)),
    fix=list(
        X1=list(A1=FALSE, A2=FALSE, A3=FALSE, A4=FALSE),
        X2=list(A1=FALSE, A5=FALSE, A6=FALSE),
        X3=list(A2=FALSE, A7=FALSE, A8=FALSE),
        X4=list(A3=FALSE, A9=FALSE, A10=FALSE),
        X5=list(A4=FALSE, A11=FALSE, A12=FALSE),
        X6=list(A5=FALSE, A13=FALSE),
        X7=list(A6=FALSE, A14=FALSE),
        X8=list(A7=FALSE, A15=FALSE),
        X9=list(A8=FALSE, A16=FALSE),
        X10=list(A9=FALSE, A17=FALSE),
        X11=list(A10=FALSE, A18=FALSE),
        X12=list(A11=FALSE, A19=FALSE),
        X13=list(A12=FALSE, A20=FALSE)),
    dims=list(
        X1=list(A1=5, A2=5, A3=5, A4=5),
        X2=list(A1=5, A5=5, A6=5),
        X3=list(A2=5, A7=5, A8=5),
        X4=list(A3=5, A9=5, A10=5),
        X5=list(A4=5, A11=5, A12=5),
        X6=list(A5=5, A13=5),
        X7=list(A6=5, A14=5),
        X8=list(A7=5, A15=5),
        X9=list(A8=5, A16=5),
        X10=list(A9=5, A17=5),
        X11=list(A10=5, A18=5),
        X12=list(A11=5, A19=5),
        X13=list(A12=5, A20=5)),
    transpose=TRUE,
    viz=TRUE,
    figdir=NULL,
    thr=1e-10,
    verbose=TRUE)

out <- CoupledMWCA(params)
expect_equal(is(out), "CoupledMWCAResult")

rec <- .recTensors(Ss=out@cores, As=out@factors)
expect_equal(length(rec), 13)
